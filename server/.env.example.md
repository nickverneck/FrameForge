# FrameForge Server Environment Configuration Guide

This document explains how to configure the FrameForge server using environment variables.

## Quick Start

1. Copy the `.env.example` file to `.env`:
   ```bash
   cd server
   cp .env.example .env
   ```

2. Edit `.env` and add your API keys

3. Start the server:
   ```bash
   cargo run
   ```

> **Note**: This configuration is for the Rust server implementation (in progress). The configuration will be loaded when the server's config module is implemented in subsequent tasks.

## Configuration Variables

### API Keys

#### `GOOGLE_API_KEY` (Optional)
- **Description**: API key for Google Gemini AI models
- **Required for**: Using the Google/nano-banana image editing provider
- **How to obtain**:
  1. Visit [Google AI Studio](https://makersuite.google.com/app/apikey)
  2. Sign in with your Google account
  3. Click "Create API Key"
  4. Copy the generated key
- **Example**: `GOOGLE_API_KEY=AIzaSyABC123def456GHI789jkl012MNO345pqr`

#### `GEMINI_API_KEY` (Optional)
- **Description**: Alternative name for Google API key (backwards compatibility)
- **Required for**: Same as `GOOGLE_API_KEY`
- **Note**: You only need to set either `GOOGLE_API_KEY` or `GEMINI_API_KEY`, not both
- **Example**: `GEMINI_API_KEY=AIzaSyABC123def456GHI789jkl012MNO345pqr`

#### `FAL_KEY` (Optional)
- **Description**: API key for Fal.ai image generation services
- **Required for**: Using Fal.ai providers (e.g., `fal:fal-ai/flux/dev`)
- **How to obtain**:
  1. Visit [Fal.ai Dashboard](https://fal.ai/dashboard/keys)
  2. Sign in or create an account
  3. Navigate to "API Keys"
  4. Create a new key
  5. Copy the generated key
- **Example**: `FAL_KEY=fal_1234567890abcdefghijklmnopqrstuvwxyz`

### Model Configuration

#### `GOOGLE_MODEL_ID` (Optional)
- **Description**: Specifies which Google Gemini model to use for image editing
- **Default**: `gemini-2.5-flash-image-preview`
- **Available models**:
  - `gemini-2.5-flash-image-preview` - Latest flash model with image capabilities (recommended)
  - `gemini-2.0-flash-exp` - Experimental flash model
  - `gemini-exp-1206` - Experimental model from December 2024
- **Example**: `GOOGLE_MODEL_ID=gemini-2.5-flash-image-preview`

### Server Configuration

#### `ALLOWED_ORIGINS` (Optional)
- **Description**: Comma-separated list of origins allowed to make requests to the API (CORS)
- **Default**: `["*"]` (allows all origins - suitable for development only)
- **Recommended for Development**: `http://localhost:3000,http://localhost:5173`
- **Production**: List only your production frontend domains
- **Security Warning**: The default `["*"]` allows ANY website to access your API. Always override this in production!
- **Examples**:
  - Development (recommended): `ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173`
  - Production (required): `ALLOWED_ORIGINS=https://myapp.com,https://www.myapp.com`

#### `HOST` (Optional)
- **Description**: IP address the server binds to
- **Default**: `0.0.0.0`
- **Options**:
  - `0.0.0.0` - Accept connections from any network interface (recommended for production)
  - `127.0.0.1` - Only accept local connections (use for local testing)
- **Example**: `HOST=0.0.0.0`

#### `PORT` (Optional)
- **Description**: Port number the server listens on
- **Default**: `8000`
- **Note**: If deploying to cloud services, the platform may override this with the `PORT` environment variable
- **Example**: `PORT=8000`

## Development vs Production

### Development Configuration
```env
GOOGLE_API_KEY=your_development_key_here
FAL_KEY=your_fal_key_here
GOOGLE_MODEL_ID=gemini-2.5-flash-image-preview
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173
HOST=127.0.0.1
PORT=8000
```

### Production Configuration
```env
GOOGLE_API_KEY=your_production_key_here
FAL_KEY=your_production_fal_key_here
GOOGLE_MODEL_ID=gemini-2.5-flash-image-preview
ALLOWED_ORIGINS=https://yourdomain.com
HOST=0.0.0.0
PORT=8000
```

## Security Best Practices

### Never Commit API Keys
- ‚úÖ The `.env` file is listed in `.gitignore` to prevent accidental commits
- ‚ùå Never commit `.env` files to version control
- ‚úÖ Always use `.env.example` as a template (without real keys)
- ‚úÖ Share API keys securely through password managers or secret management tools

### API Key Security
- üîí Keep your API keys secret and never share them publicly
- üîí Use different API keys for development and production
- üîí Rotate keys regularly
- üîí Set up billing alerts on your API accounts to detect unauthorized use
- üîí Restrict API keys by IP address or referrer when possible

### CORS Configuration
- ‚ö†Ô∏è Never use `["*"]` for `ALLOWED_ORIGINS` in production
- ‚úÖ Only list domains you control
- ‚úÖ Use HTTPS in production
- ‚úÖ Keep the list as restrictive as possible

## Troubleshooting

### "API key not found" errors
- Verify that you've created a `.env` file (not just `.env.example`)
- Check that the API key variable names match exactly (case-sensitive in some environments)
- Ensure there are no spaces around the `=` sign
- Verify the API key is valid by testing it directly with the provider's API

### CORS errors in browser
- Check that your frontend URL is listed in `ALLOWED_ORIGINS`
- Include the protocol (`http://` or `https://`)
- Include the port number if not using standard ports (80/443)
- Restart the server after changing CORS configuration

### Server won't start
- Check that the `PORT` is not already in use by another application
- If using `HOST=127.0.0.1`, verify you're connecting to `localhost` not your machine's IP
- Check server logs for specific error messages

## Environment Variable Precedence

The server loads configuration in the following order (later sources override earlier ones):
1. Default values in the code
2. Values from `.env` file
3. System environment variables
4. Runtime API keys provided via headers (for per-request overrides)

## Additional Resources

- [Google AI Studio Documentation](https://ai.google.dev/tutorials/setup)
- [Fal.ai Documentation](https://fal.ai/docs)
- [CORS Configuration Guide](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS)
